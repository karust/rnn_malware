import json
import os
from shutil import copyfile, move



def sort(filename):
    """ If there is more than 1 process in program separate this report for future analyzis """
    if num_processes > 1:
        if not os.path.exists("multi_procs"):
            os.makedirs("multi_procs")
        #move(filename, "multi_procs/" + filename)
        copyfile(filename, "multi_procs/" + filename)

reportname = "report1.json"

with open(reportname, "r") as f:
    data = json.load(f)

print(data["behavior"].keys())
num_processes = len(data["behavior"]["processes"])
#sort(reportname)

#for p in data["behavior"]["processes"]:
#    print(p["process_path"])


import csv
csvData = [['Malicious', 'API Calls', 'Statuses', 'Returns'],]

with open('data.csv', 'w') as csvFile:
    writer = csv.writer(csvFile)
    writer.writerows(csvData)
    
    apis = []
    statuses = []
    returns = []
    for i, call in enumerate(data["behavior"]["processes"][0]["calls"]):
        #print(call["api"])
        apis.append(call["api"])

        #print(call["status"])
        statuses.append(str(call["status"]))

        #print(call["return_value"])
        returns.append(str(call["return_value"]))
    
    apis = " ".join(apis)
    statuses = " ".join(statuses)
    returns = " ".join(returns)
    writer.writerows([["0", apis, statuses, returns]])